
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Поиск по документам</title>
    <link rel="stylesheet" href="/static/simple.min.css">
</head>
<body>
    <header>
        <h1>Поиск по документам</h1>
        <nav><a href="/">Поиск</a> <a href="/settings">Настройки</a></nav>
    </header>
    <main>
        <form action="/api/search/" method="post">
            <div class="grid">
                <label for="collection">Искать в коллекции
                    <select id="collection" name="collection" required>
                        <option value="" disabled selected>Выберите коллекцию</option>
                        {% for c in collections %}
                            <option value="{{ c }}" {% if c == selected_collection %}selected{% endif %}>{{ c }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label for="search_device">Устройство для поиска
                    <select id="search_device" name="search_device">
                        <option value="cpu" {% if selected_search_device == 'cpu' %}selected{% endif %}>CPU</option>
                        <option value="cuda" {% if selected_search_device == 'cuda' %}selected{% endif %}>GPU (если доступна)</option>
                    </select>
                </label>
            </div>
            <label for="query">Поисковый запрос:</label>
            <input type="text" name="query" id="query" placeholder="Введите ваш запрос..." value="{{ query or '' }}" required>
            <fieldset>
                <legend>Тип поиска</legend>
                <input type="radio" id="search_dense" name="search_type" value="dense" {% if not hybrid and selected_search_type != 'sparse' %}checked{% endif %}>
                <label for="search_dense">Плотные векторы (dense)</label><br>
                <input type="radio" id="search_sparse" name="search_type" value="sparse" {% if selected_search_type == 'sparse' %}checked{% endif %}>
                <label for="search_sparse">Разреженные векторы (BM25)</label><br>
                <input type="radio" id="search_hybrid" name="search_type" value="hybrid" {% if hybrid %}checked{% endif %}>
                <label for="search_hybrid">Гибридный режим (dense + BM25)</label><br>
                <!-- Hidden field to store hybrid flag for backward compatibility -->
                <input type="hidden" id="hybrid" name="hybrid" value="{{ 'True' if hybrid else 'False' }}">
            </fieldset>
            <button type="submit">Найти</button>
        </form>
        {% if results %}
            <h2>Результаты поиска ({{ results|length }}):</h2>
            {% for doc, score in results %}
                <article>
                    <header><b>Источник:</b> {{ doc.metadata.get('source', 'N/A') }} | <b>Сходство:</b> <mark>{{ '%.4f'|format(score) }}</mark></header>
                    <p>{{ doc.page_content }}</p>
                </article>
            {% endfor %}
        {% elif request.method == 'POST' %}
             <p>По вашему запросу ничего не найдено в коллекции '{{ selected_collection }}'.</p>
        {% endif %}
        {% if error %}
            <p style=\"color: red;\">Ошибка: {{ error }}</p>
        {% endif %}
    </main>
    <script>
        // Обработчики событий для радиокнопок поиска
        document.getElementById('search_dense').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('hybrid').value = 'False';
            }
        });
        
        document.getElementById('search_sparse').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('hybrid').value = 'False';
            }
        });
        
        document.getElementById('search_hybrid').addEventListener('change', function() {
            if (this.checked) {
                document.getElementById('hybrid').value = 'True';
            }
        });
    </script>
</body>
</html>
